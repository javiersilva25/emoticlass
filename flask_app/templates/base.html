<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Emoticlass{% endblock %}</title>

  <!-- Tailwind CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- (Opcional) Tus overrides -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  {% block extra_head %}{% endblock %}
</head>
<body class="text-gray-800">

  <!-- Topbar -->
  <header class="topbar-custom">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <a class="text-xl font-semibold tracking-wide hover:opacity-90" href="{{ url_for('auth.login') }}">Emoticlass</a>

      <button
        class="lg:hidden inline-flex items-center justify-center px-3 py-2 rounded-md bg-teal-700 hover:bg-teal-800 focus:outline-none"
        aria-label="Abrir menú"
        onclick="document.getElementById('main-nav').classList.toggle('hidden')">
        ☰
      </button>

      {% set ep = request.endpoint %}
      {% set role = session.get('user_role') %}
      <nav id="main-nav" class="hidden lg:flex items-center gap-4">
        {% if session.get('logged_in') %}
          <a class="px-3 py-2 rounded hover:bg-teal-700 {{ 'bg-teal-800' if ep=='core.dashboard' else '' }}"
             href="{{ url_for('core.dashboard') }}">Dashboard</a>

          {% if role in ['admin','utp','administrativo'] %}
          <a class="px-3 py-2 rounded hover:bg-teal-700 {{ 'bg-teal-800' if ep=='core.config' else '' }}"
             href="{{ url_for('core.config') }}">Config</a>
          {% endif %}

          <span class="hidden lg:inline-block text-teal-100">|</span>

          <div class="flex items-center gap-3">
            <span class="text-sm bg-teal-700/60 px-2.5 py-1 rounded">
              {{ session.get('user_name','Usuario') }} · {{ role|default('') }}
            </span>
            <a class="px-3 py-2 rounded bg-white text-teal-700 font-medium hover:bg-gray-100"
               href="{{ url_for('auth.logout') }}">Salir</a>
          </div>
        {% else %}
          <a class="px-3 py-2 rounded hover:bg-teal-700 {{ 'bg-teal-800' if ep=='auth.login' else '' }}"
             href="{{ url_for('auth.login') }}">Ingresar</a>
          <a class="px-3 py-2 rounded hover:bg-teal-700 {{ 'bg-teal-800' if ep=='auth.register' else '' }}"
             href="{{ url_for('auth.register') }}">Registro</a>
        {% endif %}
      </nav>
    </div>

    <!-- Menú móvil (reutiliza el mismo nav) -->
    <div id="main-nav" class="lg:hidden hidden px-4 pb-3">
      {% if session.get('logged_in') %}
        <div class="flex flex-col gap-2">
          <a class="block px-3 py-2 rounded bg-teal-700 hover:bg-teal-800 {{ 'bg-teal-800' if ep=='core.dashboard' else '' }}"
             href="{{ url_for('core.dashboard') }}">Dashboard</a>
          {% if role in ['admin','utp','administrativo'] %}
          <a class="block px-3 py-2 rounded bg-teal-700 hover:bg-teal-800 {{ 'bg-teal-800' if ep=='core.config' else '' }}"
             href="{{ url_for('core.config') }}">Config</a>
          {% endif %}
          <div class="pt-2 flex items-center justify-between">
            <span class="text-sm bg-teal-700/60 px-2.5 py-1 rounded">
              {{ session.get('user_name','Usuario') }} · {{ role|default('') }}
            </span>
            <a class="px-3 py-2 rounded bg-white text-teal-700 font-medium hover:bg-gray-100"
               href="{{ url_for('auth.logout') }}">Salir</a>
          </div>
        </div>
      {% else %}
        <div class="flex flex-col gap-2">
          <a class="block px-3 py-2 rounded bg-teal-700 hover:bg-teal-800 {{ 'bg-teal-800' if ep=='auth.login' else '' }}"
             href="{{ url_for('auth.login') }}">Ingresar</a>
          <a class="block px-3 py-2 rounded bg-teal-700 hover:bg-teal-800 {{ 'bg-teal-800' if ep=='auth.register' else '' }}"
             href="{{ url_for('auth.register') }}">Registro</a>
        </div>
      {% endif %}
    </div>
  </header>

  <!-- Contenido -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2 mb-4">
          {% for cat, msg in messages %}
            <div class="px-4 py-2 rounded border
                        {% if cat=='success' %} bg-green-50 border-green-200 text-green-800
                        {% elif cat=='error' %} bg-red-50 border-red-200 text-red-800
                        {% elif cat=='warning' %} bg-yellow-50 border-yellow-200 text-yellow-800
                        {% else %} bg-blue-50 border-blue-200 text-blue-800 {% endif %}">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  {% block scripts %}{% endblock %}
</body>
</html>
